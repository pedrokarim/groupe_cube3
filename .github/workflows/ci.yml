# ============================================================
# ğŸš€ CI/CD SIMPLE - GitHub Actions
# ============================================================
#
# ğŸ“š C'EST QUOI GitHub Actions ?
# Un outil qui exÃ©cute automatiquement du code quand tu push.
# Comme un robot qui vÃ©rifie ton code Ã  ta place !
#
# ğŸ“‚ OÃ™ METTRE CE FICHIER ?
# .github/workflows/ci.yml (ce dossier est magique pour GitHub)
#
# ============================================================

# Le nom affichÃ© dans l'onglet "Actions" de GitHub
name: CI/CD

# ============================================================
# ğŸ“Œ QUAND S'EXÃ‰CUTE CE WORKFLOW ?
# ============================================================
on:
  push:
    branches: [main]        # Ã€ chaque push sur main
  pull_request:
    branches: [main]        # Ã€ chaque PR vers main
  workflow_dispatch:         # Bouton "Run workflow" manuel

# ============================================================
# ğŸ“‹ LES JOBS (les tÃ¢ches Ã  faire)
# ============================================================
jobs:

  # ----------------------------------------------------------
  # JOB 1 : VÃ©rifier le code
  # ----------------------------------------------------------
  check:
    name: âœ… VÃ©rification du code
    runs-on: ubuntu-latest   # Machine virtuelle Linux gratuite

    steps:
      # Ã‰tape 1 : TÃ©lÃ©charger le code du repo
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      # Ã‰tape 2 : Installer Node.js
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm         # Cache les node_modules

      # Ã‰tape 3 : Installer les dÃ©pendances
      - name: ğŸ“¦ Install
        run: npm ci          # Comme npm install mais plus rapide en CI

      # Ã‰tape 4 : VÃ©rifier TypeScript
      - name: ğŸ”· TypeScript
        run: npm run typecheck
        continue-on-error: true  # Continue mÃªme si Ã§a Ã©choue

      # Ã‰tape 5 : Linter (ESLint)
      - name: ğŸ” Lint
        run: npm run lint

      # Ã‰tape 6 : Tests
      - name: ğŸ§ª Tests
        run: npm test
        continue-on-error: true  # Continue mÃªme si pas de tests

  # ----------------------------------------------------------
  # JOB 2 : Build l'application
  # ----------------------------------------------------------
  build:
    name: ğŸ—ï¸ Build
    runs-on: ubuntu-latest
    needs: check             # Attend que "check" soit fini

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: ğŸ“¦ Install
        run: npm ci

      - name: ğŸ—ï¸ Build
        run: npm run build

# ============================================================
# ğŸ“– RÃ‰SUMÃ‰ DES CONCEPTS
# ============================================================
#
# name:        â†’ Nom affichÃ© dans GitHub
# on:          â†’ Quand dÃ©clencher (push, PR, manuel)
# jobs:        â†’ Liste des tÃ¢ches
# runs-on:     â†’ Sur quelle machine (ubuntu, windows, macos)
# steps:       â†’ Ã‰tapes dans l'ordre
# uses:        â†’ Utiliser une action existante
# run:         â†’ ExÃ©cuter une commande
# needs:       â†’ DÃ©pend d'un autre job
# with:        â†’ ParamÃ¨tres pour une action
#
# ============================================================
# ğŸ”§ SCRIPTS PACKAGE.JSON NÃ‰CESSAIRES
# ============================================================
#
# {
#   "scripts": {
#     "typecheck": "tsc --noEmit",
#     "lint": "next lint",
#     "test": "vitest",
#     "build": "next build"
#   }
# }
#
# ============================================================
